{% extends "base.html" %}

{% block title %}Home - SoulBloom{% endblock %}

{% block content %}
<main>
<h3>Log in your mood regularly to keep a track of your mental wellness.</h3>    
<div class="calendar">
    <div class="calendar-header">
      <button id="prev">â®</button>
      <h2 id="monthYear"></h2>
      <button id="next">â¯</button>
    </div>
    <div class="days" id="days"></div>
  </div>

  <script>
    const monthYear = document.getElementById("monthYear");
    const daysContainer = document.getElementById("days");
    const prevBtn = document.getElementById("prev");
    const nextBtn = document.getElementById("next");

    const emojis = ["ğŸ˜¢","ğŸ˜•","ğŸ˜","ğŸ˜Š","ğŸ˜„"];
    let currentDate = new Date();
    let moods = {};

    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      monthYear.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });
      
      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();

      daysContainer.innerHTML = "";

      for (let i = 0; i < firstDay; i++) {
        daysContainer.innerHTML += `<div></div>`;
      }

      for (let day = 1; day <= lastDate; day++) {
        const cell = document.createElement("div");
        cell.classList.add("day");
        cell.innerHTML = `${day}`;
        
        // If mood already set, show emoji
        const key = `${year}-${month}-${day}`;
        if (moods[key]) {
          cell.innerHTML += `<div>${moods[key]}</div>`;
        }

        // Create emoji popup
        const popup = document.createElement("div");
        popup.classList.add("emoji-popup");
        emojis.forEach(emoji => {
          const span = document.createElement("span");
          span.textContent = emoji;
          span.onclick = () => {
            moods[key] = emoji;
            renderCalendar();
          };
          popup.appendChild(span);
        });
        cell.appendChild(popup);

        // Show popup on click
        cell.onclick = (e) => {
          e.stopPropagation();
          document.querySelectorAll(".emoji-popup").forEach(p => p.style.display = "none");
          popup.style.display = "block";
        };

        daysContainer.appendChild(cell);
      }
    }

    prevBtn.onclick = () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); };
    nextBtn.onclick = () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); };

    // Close popup when clicking outside
    document.body.onclick = () => {
      document.querySelectorAll(".emoji-popup").forEach(p => p.style.display = "none");
    };

    renderCalendar();
  </script>
</main>
{% endblock %}